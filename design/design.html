<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Design Choices</title>
  
  <meta name="author" content="one"/>
  
  
  <meta name="description" content="S"/>
  
  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/site/laika-helium.css" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <script src="../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="icon-link glyph-link" href="../"><i class="icofont-laika home" title="Home">&#xef47;</i></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://github.com/dragonfly-ai/slash"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://github.com/dragonfly-ai/slash"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../">Introduction</a></li>
    <li class="level1 nav-header">basics</li>
    <li class="level2 nav-leaf"><a href="../basics/getting_started.html">Getting started</a></li>
    <li class="level1 nav-header">demo</li>
    <li class="level2 nav-leaf"><a href="../demo/factorial.html">Factorial</a></li>
    <li class="level2 nav-leaf"><a href="../demo/gamma.html">Gamma</a></li>
    <li class="level2 nav-leaf"><a href="../demo/logs.html">Logarithms</a></li>
    <li class="level2 nav-leaf"><a href="../demo/poisson.html">Poisson Distribution</a></li>
    <li class="level2 nav-leaf"><a href="../demo/scalarOps.html">Vector Scalar Operations</a></li>
    <li class="level1 nav-header">design</li>
    <li class="level2 active nav-leaf"><a href="#">Design Choices</a></li>
    <li class="level1 nav-header">matrix</li>
    <li class="level2 nav-leaf"><a href="../matrix/matrix.html">Matricies introduction</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Design Choices</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#combining-strengths">Combining strengths</a></li>
    <li class="level1 nav-node"><a href="#case-classes">Case Classes</a></li>
    <li class="level2 nav-leaf"><a href="#strictly-immutable">Strictly Immutable</a></li>
    <li class="level2 nav-leaf"><a href="#strictly-mutable-version">Strictly Mutable Version</a></li>
    <li class="level2 nav-leaf"><a href="#hybrid-version">Hybrid Version</a></li>
    <li class="level1 nav-node"><a href="#wrappers-and-traits">Wrappers and Traits</a></li>
    <li class="level2 nav-leaf"><a href="#notes-2">Notes</a></li>
    <li class="level1 nav-leaf"><a href="#arrays">Arrays</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="design-choices" class="title">Design Choices</h1>
        <p>This library learns from and sets out to optimse the tradeoffs found in vector math libraries. The thought process for which is illustrated below, although with a summary of the implications of other design choices.</p>
        
        <h3 id="combining-strengths" class="section"><a class="anchor-link left" href="#combining-strengths"><i class="icofont-laika link">&#xef71;</i></a>Combining strengths</h3>
        <p>We want</p>
        <ul>
          <li>a Vector type with more robust compile time error detection than the <a href="#case-classes">Case Class</a> method</li>
          <li>more flexibility than the <a href="#wrappers-and-traits">Traits and Wrappers</a> method</li>
          <li>native <a href="#arrays">Array performance</a> and memory characteristics</li>
        </ul>
        <p><a href="https://github.com/dragonfly-ai/vector/blob/cb962a3b9d154eea37ffec877b25fa256e374ba7/vector/shared/src/main/scala/ai/dragonfly/math/vector/package.scala#L27">Here&#39;s the proposal</a></p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">narr</span><span>.*
</span><span class="keyword">import</span><span> </span><span class="identifier">scala</span><span>.</span><span class="identifier">compiletime</span><span>.</span><span class="identifier">ops</span><span>.</span><span class="identifier">int</span><span>.*

</span><span class="keyword">package</span><span> </span><span class="keyword">object</span><span> </span><span class="identifier">vector</span><span> {

  </span><span class="comment">// What if the dimension occupied the type parameter?
</span><span>  </span><span class="comment">// Now we can have the syntax of case class vectors on types that reduce to pure natively typed arrays at runtime!
</span><span>  </span><span class="identifier">opaque</span><span> </span><span class="keyword">type</span><span> </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span> &lt;: </span><span class="type-name">Int</span><span>] = </span><span class="type-name">NArray</span><span>[</span><span class="type-name">Double</span><span>] </span><span class="comment">// NArray is a type alias for the best available native Array type.
</span><span>
  </span><span class="keyword">object</span><span> </span><span class="type-name">Vector</span><span> {
    </span><span class="comment">// convenient factory methods for Vec[2], Vec[3], and Vec[4]
</span><span>    </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">x</span><span>: </span><span class="type-name">Double</span><span>, </span><span class="identifier">y</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Vec</span><span>[</span><span class="number-literal">2</span><span>] = </span><span class="type-name">NArray</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span>)
    </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">x</span><span>: </span><span class="type-name">Double</span><span>, </span><span class="identifier">y</span><span>: </span><span class="type-name">Double</span><span>, </span><span class="identifier">z</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Vec</span><span>[</span><span class="number-literal">3</span><span>] = </span><span class="type-name">NArray</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span>, </span><span class="identifier">z</span><span>)
    </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">x</span><span>: </span><span class="type-name">Double</span><span>, </span><span class="identifier">y</span><span>: </span><span class="type-name">Double</span><span>, </span><span class="identifier">z</span><span>: </span><span class="type-name">Double</span><span>, </span><span class="identifier">w</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Vec</span><span>[</span><span class="number-literal">4</span><span>] = </span><span class="type-name">NArray</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span>, </span><span class="identifier">z</span><span>, </span><span class="identifier">w</span><span>)

    </span><span class="comment">// painless conversion from NArray[Double] to Vec[N]
</span><span>    </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>[</span><span class="type-name">N</span><span> &lt;: </span><span class="type-name">Int</span><span>](</span><span class="identifier">a</span><span>: </span><span class="type-name">NArray</span><span>[</span><span class="type-name">Double</span><span>]): </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>] = { </span><span class="comment">// sneaky way to cast an NArray[Double] to a Vec[N]
</span><span>      </span><span class="identifier">dimensionCheck</span><span>(</span><span class="identifier">a</span><span>, </span><span class="identifier">valueOf</span><span>[</span><span class="type-name">N</span><span>])
      </span><span class="identifier">a</span><span>
    }

    </span><span class="comment">// We get convenient object oriented syntax through the use of extension methods:
</span><span>    </span><span class="identifier">extension</span><span>[</span><span class="type-name">N</span><span> &lt;: </span><span class="type-name">Int</span><span>] (</span><span class="identifier">thisVector</span><span>: </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>]) {
      </span><span class="comment">// inline everywhere, for speed!
</span><span>      </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">dimension</span><span>: </span><span class="type-name">Int</span><span> = </span><span class="identifier">thisVector</span><span>.</span><span class="identifier">length</span><span>
      </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">index</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Double</span><span> = </span><span class="identifier">thisVector</span><span>(</span><span class="identifier">index</span><span>)
      </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">update</span><span>(</span><span class="identifier">index</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">value</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Unit</span><span> = </span><span class="identifier">thisVector</span><span>(</span><span class="identifier">index</span><span>) = </span><span class="identifier">value</span><span>

      </span><span class="comment">// immutable support (and native array copy is fast!)
</span><span>      </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> +(</span><span class="identifier">v0</span><span>: </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>]): </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>] = </span><span class="identifier">copy</span><span>.</span><span class="identifier">add</span><span>(</span><span class="identifier">v0</span><span>)

      </span><span class="comment">// mutable support for those who need speed more than safety:
</span><span>      </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> += (</span><span class="identifier">v0</span><span>: </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>]): </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>] = </span><span class="identifier">add</span><span>(</span><span class="identifier">v0</span><span>)

      </span><span class="comment">// one add method for all vectors of all possible dimensions (phew maintenance)
</span><span>      </span><span class="keyword">def</span><span> </span><span class="declaration-name">add</span><span>(</span><span class="identifier">v0</span><span>: </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>]): </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>] = {
        </span><span class="keyword">var</span><span> </span><span class="identifier">i</span><span> = </span><span class="number-literal">0</span><span>
        </span><span class="keyword">while</span><span> (</span><span class="identifier">i</span><span> &lt; </span><span class="identifier">dimension</span><span>) {
          </span><span class="identifier">thisVector</span><span>(</span><span class="identifier">i</span><span>) = </span><span class="identifier">thisVector</span><span>(</span><span class="identifier">i</span><span>) + </span><span class="identifier">v0</span><span>(</span><span class="identifier">i</span><span>)
          </span><span class="identifier">i</span><span> = </span><span class="identifier">i</span><span> + </span><span class="number-literal">1</span><span>
        }
        </span><span class="identifier">thisVector</span><span>
      }
    }
}</span></code></pre>
        <p>Please consider also, the flexibility to enable types that use Vectors of varying sizes:</p>
        <pre><code class="nohighlight"><span class="keyword">package</span><span> </span><span class="identifier">slash</span><span>.</span><span class="identifier">vector</span><span>
</span><span class="keyword">import</span><span> </span><span class="type-name">Vector</span><span>.*

</span><span class="comment">// instead of putting the Vector type in the type parameter, just place the vector dimensionality.
</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">VectorBounds</span><span>[</span><span class="type-name">N</span><span> &lt;: </span><span class="type-name">Int</span><span>](</span><span class="identifier">min</span><span>: </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>], </span><span class="type-name">MAX</span><span>: </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>]) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">contains</span><span>(</span><span class="identifier">v</span><span>: </span><span class="type-name">Vec</span><span>[</span><span class="type-name">N</span><span>]):</span><span class="type-name">Boolean</span><span> = {
    </span><span class="keyword">var</span><span> </span><span class="identifier">o</span><span>:</span><span class="type-name">Boolean</span><span> = </span><span class="boolean-literal">true</span><span>
    </span><span class="keyword">var</span><span> </span><span class="identifier">i</span><span>:</span><span class="type-name">Int</span><span> = </span><span class="number-literal">0</span><span>; </span><span class="keyword">while</span><span>(</span><span class="identifier">o</span><span> &amp;&amp; </span><span class="identifier">i</span><span> &lt; </span><span class="identifier">min</span><span>.</span><span class="identifier">dimension</span><span>) {
      </span><span class="identifier">o</span><span> = </span><span class="identifier">min</span><span>(</span><span class="identifier">i</span><span>) &lt;= </span><span class="identifier">v</span><span>(</span><span class="identifier">i</span><span>) &amp;&amp; </span><span class="identifier">v</span><span>(</span><span class="identifier">i</span><span>) &lt;= </span><span class="type-name">MAX</span><span>(</span><span class="identifier">i</span><span>)
      </span><span class="identifier">i</span><span> += </span><span class="number-literal">1</span><span>
    }
    </span><span class="identifier">o</span><span>
  }
}</span></code></pre>
        <p>The below sections set out the prior art and experiments to get to the proposal above</p>
        
        <h2 id="case-classes" class="section"><a class="anchor-link left" href="#case-classes"><i class="icofont-laika link">&#xef71;</i></a>Case Classes</h2>
        <p><a href="https://scastie.scala-lang.org/ClaUW7DmQOCtT2rlAhFEtg">Example</a></p>
        <p>Vector types very commonly appear in the form of case classes like the examples below.</p>
        <p>The Scala.js game engine <a href="https://github.com/PurpleKingdomGames/indigo/blob/main/indigo/indigo/src/main/scala/indigo/shared/datatypes/Vector2.scala#L5">indigo</a> and the earliest versions of this library adopted this approach.</p>
        <p>It has the advantage of beiong very legible and intuitive.</p>
        <p>Yet may lag in relative performance - designing itself out of compute intensive applications. Potentially high memory overhead for what&#39;s essentially an ordered sequence of <code>Double</code>. Extending to matricies may get messy - how should case classes represent vectors of high dimension or dimensions determined at run time?</p>
        <p>Scala case classes don&#39;t readily serialize efficiently to JSON or Binary, weakening the cross platform story, and making them apparently less useful to native Java, C, and JavaScript developers who have attractive alternatives like native arrays.</p>
        <p>Case class implementations tend to appear in three major flavors: Immutable, Mutable, and Hybrid:</p>
        
        <h3 id="strictly-immutable" class="section"><a class="anchor-link left" href="#strictly-immutable"><i class="icofont-laika link">&#xef71;</i></a>Strictly Immutable</h3>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Vector2</span><span>(</span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> + (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector2</span><span>):</span><span class="type-name">Vector2</span><span> = </span><span class="type-name">Vector2</span><span>(
    </span><span class="identifier">x</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>
  )
}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Vector3</span><span>(</span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="identifier">z</span><span>:</span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> + (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector3</span><span>):</span><span class="type-name">Vector3</span><span> = </span><span class="type-name">Vector3</span><span>(
    </span><span class="identifier">x</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>, </span><span class="identifier">z</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">z</span><span>
  )
}</span></code></pre>
        
        <h3 id="strictly-mutable-version" class="section"><a class="anchor-link left" href="#strictly-mutable-version"><i class="icofont-laika link">&#xef71;</i></a>Strictly Mutable Version</h3>
        <pre><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Vector2</span><span>(</span><span class="keyword">var</span><span> </span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="keyword">var</span><span> </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> += (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector2</span><span>):</span><span class="type-name">Vector2</span><span> = {
    </span><span class="identifier">x</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>; </span><span class="identifier">y</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>
    </span><span class="keyword">this</span><span>
  }
}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Vector3</span><span>(</span><span class="keyword">var</span><span> </span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="keyword">var</span><span> </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="keyword">var</span><span> </span><span class="identifier">z</span><span>:</span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> += (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector3</span><span>):</span><span class="type-name">Vector3</span><span> = {
    </span><span class="identifier">x</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>; </span><span class="identifier">y</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>; </span><span class="identifier">z</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">z</span><span>
    </span><span class="keyword">this</span><span>
  }
}</span></code></pre>
        
        <h3 id="hybrid-version" class="section"><a class="anchor-link left" href="#hybrid-version"><i class="icofont-laika link">&#xef71;</i></a>Hybrid Version</h3>
        <p>May offer Immutable or Mutable Behavior:</p>
        <pre><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Vector2</span><span>(</span><span class="keyword">var</span><span> </span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="keyword">var</span><span> </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> + (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector2</span><span>):</span><span class="type-name">Vector2</span><span> = </span><span class="type-name">Vector2</span><span>(
    </span><span class="identifier">x</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>
  )
  </span><span class="keyword">def</span><span> += (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector2</span><span>):</span><span class="type-name">Vector2</span><span> = {
    </span><span class="identifier">x</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>; </span><span class="identifier">y</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>
    </span><span class="keyword">this</span><span>
  }
}

</span><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">Vector3</span><span>(</span><span class="keyword">var</span><span> </span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="keyword">var</span><span> </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="keyword">var</span><span> </span><span class="identifier">z</span><span>:</span><span class="type-name">Double</span><span>) {
  </span><span class="keyword">def</span><span> + (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector3</span><span>):</span><span class="type-name">Vector3</span><span> = </span><span class="type-name">Vector3</span><span>(
    </span><span class="identifier">x</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>, </span><span class="identifier">z</span><span> + </span><span class="identifier">that</span><span>.</span><span class="identifier">z</span><span>
  )
  </span><span class="keyword">def</span><span> += (</span><span class="identifier">that</span><span>:</span><span class="type-name">Vector3</span><span>):</span><span class="type-name">Vector3</span><span> = {
    </span><span class="identifier">x</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">x</span><span>; </span><span class="identifier">y</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">y</span><span>; </span><span class="identifier">z</span><span> += </span><span class="identifier">that</span><span>.</span><span class="identifier">z</span><span>
    </span><span class="keyword">this</span><span>
  }
}</span></code></pre>
        
        <h4 id="advantages" class="section"><a class="anchor-link left" href="#advantages"><i class="icofont-laika link">&#xef71;</i></a>Advantages</h4>
        <p>Intuitive syntax.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">v</span><span> = </span><span class="type-name">Vector2</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>) + </span><span class="type-name">Vector2</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>)</span></code></pre>
        <p>Type Safe.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// compiler error:
</span><span class="keyword">val</span><span> </span><span class="identifier">v3</span><span> = </span><span class="type-name">Vector2</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>) + </span><span class="type-name">Vector3</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>, </span><span class="number-literal">0.125</span><span>)</span></code></pre>
        <p>Potentially Strictly Immutable</p>
        <p>Human Readable <code>toString</code> =&gt; <code>Vector2(1.0,0.5)</code>.</p>
        <ul>
          <li>Supports Overloaded Operators: <code>+, -, *, /, etc.</code></li>
          <li>No runtime errors.</li>
          <li>Dimensionality built into the type; no runtime dimension checking
          -No loop overhead for + method</li>
        </ul>
        
        <h4 id="notes-1" class="section"><a class="anchor-link left" href="#notes-1"><i class="icofont-laika link">&#xef71;</i></a>Notes</h4>
        <p>Not generic:  Suppose we need a <code>VectorBounds</code> class which can tell whether a vector lies within a rectangular volume or not.  Because <code>Vector2</code> and <code>Vector3</code> are entirely distinct types, we need separate implementations of <code>VectorBounds</code> for every possible dimensionality.</p>
        <p>Tempts users into relying on <code>.equals</code> and <code>.hashcode</code>.  However, in practice, floating point errors make <code>Vector</code> vector data error prone when used as <code>Map</code> keys or in equality testing.  For example:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// Returns true only sometimes:
</span><span class="identifier">v2</span><span>.</span><span class="identifier">equals</span><span>( </span><span class="identifier">v2</span><span>.</span><span class="identifier">rotate</span><span>(</span><span class="type-name">Math</span><span>.</span><span class="type-name">PI</span><span> / </span><span class="number-literal">4.0</span><span>).</span><span class="identifier">rotate</span><span>(-</span><span class="type-name">Math</span><span>.</span><span class="type-name">PI</span><span> / </span><span class="number-literal">4.0</span><span>) )</span></code></pre>
        <p>Not portable.  <code>Array[Double]</code> has long served as the common currency between machine learning, statistics, matrix, and other math libraries on all of Scala&#39;s target platforms.  Case classes, by contrast, require conversions to make use of 3rd party libraries.</p>
        <p>Bloated default serializations.  Whether JSON, or binary, automatic serializations of case classes create more bloated formats than <code>Array[Double]</code>.  For example, we might prefer JSON in the format:
        <code>[1.0, 2.0, 3.0]</code> instead of <code>{ &quot;x&quot; : 1.0, &quot;y&quot; : 2.0, &quot;z&quot; : 3.0 }</code>.</p>
        
        <h2 id="wrappers-and-traits" class="section"><a class="anchor-link left" href="#wrappers-and-traits"><i class="icofont-laika link">&#xef71;</i></a>Wrappers and Traits</h2>
        <p><a href="https://scastie.scala-lang.org/oH0TYuYERCa8w21NeKjwrw">Example</a></p>
        <p>Increase flexibility and may reduce maintenance costs <a href="https://github.com/dragonfly-ai/vector/blob/c9e370545d96a8e341b63e1c4ee39be846b0f970/vector/shared/src/main/scala/ai/dragonfly/math/vector/Vector3.scala#L25">Prototype versions</a> of this library as recent as 2023 used this approach.  With inheritance, type tricks, and wrappers, this kind of design can consolidate most vector operations e.g. <code>+</code>, <code>-</code>, <code>magnitude</code>, and <code>scale</code> across all vector dimension types into a shared trait.</p>
        <p>Unfortunately, the design becomes complex and error prone, without improving performance much.</p>
        <pre><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">dimCheck</span><span>(</span><span class="identifier">sup</span><span>:</span><span class="type-name">Int</span><span>, </span><span class="identifier">req</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Unit</span><span> = {
  </span><span class="keyword">if</span><span>(</span><span class="identifier">sup</span><span>!=</span><span class="identifier">req</span><span>) </span><span class="keyword">throw</span><span> </span><span class="type-name">Exception</span><span>(</span><span class="string-literal">&quot;Mismatched Dimensions!&quot;</span><span>)
}

</span><span class="keyword">trait</span><span> </span><span class="type-name">Vector</span><span> {
  </span><span class="keyword">type</span><span> </span><span class="type-name">VEC</span><span> &lt;: </span><span class="type-name">Vector</span><span>
  </span><span class="keyword">val</span><span> </span><span class="identifier">dimension</span><span>:</span><span class="type-name">Int</span><span>

  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">i</span><span>:</span><span class="type-name">Int</span><span>):</span><span class="type-name">Double</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">update</span><span>(</span><span class="identifier">i</span><span>:</span><span class="type-name">Int</span><span>, </span><span class="identifier">d</span><span>:</span><span class="type-name">Double</span><span>): </span><span class="type-name">Unit</span><span>
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">zeros</span><span>:</span><span class="type-name">VEC</span><span>
  </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> +(</span><span class="identifier">that</span><span>:</span><span class="type-name">VEC</span><span>):</span><span class="type-name">VEC</span><span> = {
    </span><span class="identifier">dimCheck</span><span>(</span><span class="identifier">dimension</span><span>, </span><span class="identifier">that</span><span>.</span><span class="identifier">dimension</span><span>)
    </span><span class="keyword">val</span><span> </span><span class="identifier">out</span><span> = </span><span class="identifier">zeros</span><span>
    </span><span class="keyword">var</span><span> </span><span class="identifier">i</span><span> = </span><span class="number-literal">0</span><span>; </span><span class="keyword">while</span><span>(</span><span class="identifier">i</span><span> &lt; </span><span class="identifier">dimension</span><span>) {
      </span><span class="identifier">out</span><span>(</span><span class="identifier">i</span><span>) = </span><span class="keyword">this</span><span>(</span><span class="identifier">i</span><span>) + </span><span class="identifier">that</span><span>(</span><span class="identifier">i</span><span>)
      </span><span class="identifier">i</span><span> = </span><span class="identifier">i</span><span> + </span><span class="number-literal">1</span><span>
    }
    </span><span class="identifier">out</span><span>
  }
}

</span><span class="keyword">object</span><span> </span><span class="type-name">Vector2</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">values</span><span>:</span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>]): </span><span class="type-name">Vector2</span><span> = {
    </span><span class="identifier">dimCheck</span><span>(</span><span class="number-literal">2</span><span>, </span><span class="identifier">values</span><span>.</span><span class="identifier">length</span><span>); </span><span class="keyword">new</span><span> </span><span class="type-name">Vector2</span><span>(</span><span class="identifier">values</span><span>)
  }
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>): </span><span class="type-name">Vector2</span><span> = {
    </span><span class="keyword">new</span><span> </span><span class="type-name">Vector2</span><span>(</span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span>))
  }
}

</span><span class="keyword">class</span><span> </span><span class="type-name">Vector2</span><span> </span><span class="keyword">private</span><span> (</span><span class="identifier">values</span><span>:</span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>]) </span><span class="keyword">extends</span><span> </span><span class="type-name">Vector</span><span> {
  </span><span class="keyword">type</span><span> </span><span class="type-name">VEC</span><span> = </span><span class="type-name">Vector2</span><span>
  </span><span class="keyword">override</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">dimension</span><span>:</span><span class="type-name">Int</span><span> = </span><span class="number-literal">2</span><span>
  </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">x</span><span>:</span><span class="type-name">Double</span><span> = </span><span class="identifier">values</span><span>(</span><span class="number-literal">0</span><span>)
  </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">y</span><span>:</span><span class="type-name">Double</span><span> = </span><span class="identifier">values</span><span>(</span><span class="number-literal">1</span><span>)
  </span><span class="identifier">inline</span><span> </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">index</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Double</span><span> = </span><span class="identifier">values</span><span>(</span><span class="identifier">index</span><span>)
  </span><span class="identifier">inline</span><span> </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">update</span><span>(</span><span class="identifier">index</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">value</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Unit</span><span> = {
    </span><span class="identifier">values</span><span>(</span><span class="identifier">index</span><span>) = </span><span class="identifier">value</span><span>
  }
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">zeros</span><span>:</span><span class="type-name">Vector2</span><span> = </span><span class="type-name">Vector2</span><span>(</span><span class="number-literal">0.0</span><span>, </span><span class="number-literal">0.0</span><span>)
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">toString</span><span>:</span><span class="type-name">String</span><span> = </span><span class="string-literal">s&quot;Vector2(</span><span class="substitution">$x</span><span class="string-literal">, </span><span class="substitution">$y</span><span class="string-literal">)&quot;</span><span>
}

</span><span class="keyword">object</span><span> </span><span class="type-name">Vector3</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">values</span><span>:</span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>]): </span><span class="type-name">Vector3</span><span> = {
    </span><span class="identifier">dimCheck</span><span>(</span><span class="number-literal">3</span><span>, </span><span class="identifier">values</span><span>.</span><span class="identifier">length</span><span>); </span><span class="keyword">new</span><span> </span><span class="type-name">Vector3</span><span>(</span><span class="identifier">values</span><span>)
  }
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">x</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="identifier">y</span><span>:</span><span class="type-name">Double</span><span>, </span><span class="identifier">z</span><span>:</span><span class="type-name">Double</span><span>): </span><span class="type-name">Vector3</span><span> = {
    </span><span class="keyword">new</span><span> </span><span class="type-name">Vector3</span><span>(</span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="identifier">x</span><span>, </span><span class="identifier">y</span><span>, </span><span class="identifier">z</span><span>))
  }
}

</span><span class="keyword">class</span><span> </span><span class="type-name">Vector3</span><span> </span><span class="keyword">private</span><span> (</span><span class="identifier">values</span><span>:</span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>]) </span><span class="keyword">extends</span><span> </span><span class="type-name">Vector</span><span> {
  </span><span class="keyword">type</span><span> </span><span class="type-name">VEC</span><span> = </span><span class="type-name">Vector3</span><span>
  </span><span class="keyword">override</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">dimension</span><span>:</span><span class="type-name">Int</span><span> = </span><span class="number-literal">3</span><span>
  </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">x</span><span>:</span><span class="type-name">Double</span><span> = </span><span class="identifier">values</span><span>(</span><span class="number-literal">0</span><span>)
  </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">y</span><span>:</span><span class="type-name">Double</span><span> = </span><span class="identifier">values</span><span>(</span><span class="number-literal">1</span><span>)
  </span><span class="identifier">inline</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">z</span><span>:</span><span class="type-name">Double</span><span> = </span><span class="identifier">values</span><span>(</span><span class="number-literal">1</span><span>)

  </span><span class="identifier">inline</span><span> </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">apply</span><span>(</span><span class="identifier">index</span><span>: </span><span class="type-name">Int</span><span>): </span><span class="type-name">Double</span><span> = </span><span class="identifier">values</span><span>(</span><span class="identifier">index</span><span>)
  </span><span class="identifier">inline</span><span> </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">update</span><span>(</span><span class="identifier">index</span><span>: </span><span class="type-name">Int</span><span>, </span><span class="identifier">value</span><span>: </span><span class="type-name">Double</span><span>): </span><span class="type-name">Unit</span><span> = {
    </span><span class="identifier">values</span><span>(</span><span class="identifier">index</span><span>) = </span><span class="identifier">value</span><span>
  }

  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">zeros</span><span>:</span><span class="type-name">Vector3</span><span> = </span><span class="type-name">Vector3</span><span>(</span><span class="number-literal">0.0</span><span>, </span><span class="number-literal">0.0</span><span>, </span><span class="number-literal">0.0</span><span>)
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">toString</span><span>:</span><span class="type-name">String</span><span> = </span><span class="string-literal">s&quot;Vector3(</span><span class="substitution">$x</span><span class="string-literal">, </span><span class="substitution">$y</span><span class="string-literal">, </span><span class="substitution">$z</span><span class="string-literal">)&quot;</span><span>
}</span></code></pre>
        
        <h3 id="notes-2" class="section"><a class="anchor-link left" href="#notes-2"><i class="icofont-laika link">&#xef71;</i></a>Notes</h3>
        <p>Intuitive syntax.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">v</span><span> = </span><span class="type-name">Vector2</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>) + </span><span class="type-name">Vector2</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>)</span></code></pre>
        <p>Type Safe.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// compiler error:
</span><span class="keyword">val</span><span> </span><span class="identifier">v3</span><span> = </span><span class="type-name">Vector2</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>) + </span><span class="type-name">Vector3</span><span>(</span><span class="number-literal">0.5</span><span>, </span><span class="number-literal">0.25</span><span>, </span><span class="number-literal">0.125</span><span>)</span></code></pre>
        <p>Potentially Strictly Immutable
        Allows overrides for <code>toString</code>.
        Supports Overloaded Operators: <code>+, -, *, /, etc.</code></p>
        <p>No runtime errors from operations involving multiple vectors of the same, explicitly defined, low dimensional type.
        Generic.  Supports syntax like:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">case</span><span> </span><span class="keyword">class</span><span> </span><span class="type-name">VectorBounds</span><span>[</span><span class="type-name">V</span><span> &lt;: </span><span class="type-name">Vector</span><span>](</span><span class="identifier">min</span><span>:</span><span class="type-name">V</span><span>, </span><span class="type-name">MAX</span><span>:</span><span class="type-name">V</span><span>) {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">contains</span><span>(</span><span class="identifier">v</span><span>: </span><span class="type-name">V</span><span>): </span><span class="type-name">Boolean</span><span> = {
    </span><span class="keyword">var</span><span> </span><span class="identifier">o</span><span>: </span><span class="type-name">Boolean</span><span> = </span><span class="boolean-literal">true</span><span>
    </span><span class="keyword">var</span><span> </span><span class="identifier">i</span><span>: </span><span class="type-name">Int</span><span> = </span><span class="number-literal">0</span><span>; </span><span class="keyword">while</span><span> (</span><span class="identifier">o</span><span> &amp;&amp; </span><span class="identifier">i</span><span> &lt; </span><span class="identifier">min</span><span>.</span><span class="identifier">dimension</span><span>) {
      </span><span class="identifier">o</span><span> = </span><span class="identifier">min</span><span>.</span><span class="identifier">component</span><span>(</span><span class="identifier">i</span><span>) &lt;= </span><span class="identifier">v</span><span>.</span><span class="identifier">component</span><span>(</span><span class="identifier">i</span><span>) &amp;&amp; </span><span class="identifier">v</span><span>.</span><span class="identifier">component</span><span>(</span><span class="identifier">i</span><span>) &lt;= </span><span class="type-name">MAX</span><span>.</span><span class="identifier">component</span><span>(</span><span class="identifier">i</span><span>)
      </span><span class="identifier">i</span><span> += </span><span class="number-literal">1</span><span>
    }
    </span><span class="identifier">o</span><span>
  }
}</span></code></pre>
        <p>Shares common methods between vector implementations instead of forcing unique implementations for every possible dimensionality.
        Only one implementation for every possible vector dimension (!)
        Accommodates higher dimensional vectors, but without compile time dimensionality-linked type safety:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">class</span><span> </span><span class="type-name">VectorN</span><span> </span><span class="keyword">private</span><span> (</span><span class="keyword">override</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">values</span><span>:</span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>]) </span><span class="keyword">extends</span><span> </span><span class="type-name">Vector</span><span> { }</span></code></pre>
        <p>Disadvantages:</p>
        <ul>
          <li>Complicated!</li>
          <li>Slow: relies on traits and wrappers for convenient syntax at the expense of runtime performance</li>
          <li>Memory intensive: suffers from too many runtime dimension checks, wrapper instantiations, and trait abstraction overhead</li>
        </ul>
        <p>Allows overrides for <code>hashCode</code> and <code>equals</code> which tempts developers into making bad business logic decisions.</p>
        <ul>
          <li>Runtime dimensionality checks on every operation involving two vectors</li>
          <li>Exposes some runtime errors when creating Vector types from arrays of incorrect length</li>
        </ul>
        <p>Slightly less bloated default serializations.  For example, we might prefer JSON in the format:
        <code>[1.0, 2.0, 3.0]</code> instead of <code>{ &quot;values&quot; : [1.0, 2.0, 3.0] }</code>.</p>
        
        <h2 id="arrays" class="section"><a class="anchor-link left" href="#arrays"><i class="icofont-laika link">&#xef71;</i></a>Arrays</h2>
        <p><a href="https://scastie.scala-lang.org/VVTNglXrSrW8uDrd9iYmyg">Example</a></p>
        <p>Performance first taking advatnage of native runtime array optimisations. Minimizes memory footprint, and unless it abandons runtime dimension checking, also maximizes speed.</p>
        <p>Unfortunately, emphasizing performance in this way may lead to runtime errors and unpleasant syntax.</p>
        <pre><code class="nohighlight"><span class="keyword">type</span><span> </span><span class="type-name">Vector</span><span> = </span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>]

</span><span class="keyword">object</span><span> </span><span class="type-name">Vector</span><span> {
  </span><span class="keyword">def</span><span> </span><span class="declaration-name">plus</span><span>(</span><span class="identifier">v1</span><span>:</span><span class="type-name">Vector</span><span>, </span><span class="identifier">v2</span><span>:</span><span class="type-name">Vector</span><span>):</span><span class="type-name">Vector</span><span> = {
    </span><span class="keyword">if</span><span> (</span><span class="identifier">v1</span><span>.</span><span class="identifier">length</span><span> != </span><span class="identifier">v2</span><span>.</span><span class="identifier">length</span><span>) {
      </span><span class="keyword">throw</span><span> </span><span class="type-name">Exception</span><span>(</span><span class="string-literal">&quot;Mismatched Vector Dimensions!&quot;</span><span>)
    } </span><span class="keyword">else</span><span> {
      </span><span class="keyword">val</span><span> </span><span class="identifier">out</span><span>: </span><span class="type-name">Vector</span><span> = </span><span class="keyword">new</span><span> </span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="identifier">v1</span><span>.</span><span class="identifier">length</span><span>)
      </span><span class="keyword">var</span><span> </span><span class="identifier">i</span><span>:</span><span class="type-name">Int</span><span> = </span><span class="number-literal">0</span><span>
      </span><span class="keyword">while</span><span> (</span><span class="identifier">i</span><span> &lt; </span><span class="identifier">v1</span><span>.</span><span class="identifier">length</span><span>) {
        </span><span class="identifier">out</span><span>(</span><span class="identifier">i</span><span>) = </span><span class="identifier">v1</span><span>(</span><span class="identifier">i</span><span>) + </span><span class="identifier">v2</span><span>(</span><span class="identifier">i</span><span>)
        </span><span class="identifier">i</span><span> += </span><span class="number-literal">1</span><span>
      }
      </span><span class="identifier">out</span><span>
    }
  }
}</span></code></pre>
        <p>Notes:</p>
        <ul>
          <li>Fast, allowing for compute intense tasks at (near) native performance</li>
          <li>Minimal memory footprint</li>
          <li>Potentially simplest code base to maintain</li>
        </ul>
        <p>Optimally concise default serialization formats with JSON defaulting to:
        <code>[1.0, 2.0, 3.0]</code></p>
        <p>Disadvantages:
        No vector dimensionality errors detected at compile time; they only appear as runtime errors.
        Potentially poor user syntax:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">v1</span><span>:</span><span class="type-name">Vector</span><span> = </span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="number-literal">1.0</span><span>, </span><span class="number-literal">2.0</span><span>)
</span><span class="keyword">val</span><span> </span><span class="identifier">v2</span><span>:</span><span class="type-name">Vector</span><span> = </span><span class="type-name">Array</span><span>[</span><span class="type-name">Double</span><span>](</span><span class="number-literal">3.0</span><span>, </span><span class="number-literal">4.0</span><span>, </span><span class="number-literal">5.0</span><span>)
</span><span class="comment">// runtime exception instead of compiler error
</span><span class="keyword">val</span><span> </span><span class="identifier">v3</span><span>:</span><span class="type-name">Vector</span><span> = </span><span class="type-name">Vector</span><span>.</span><span class="identifier">plus</span><span>(</span><span class="identifier">v1</span><span>, </span><span class="identifier">v2</span><span>)</span></code></pre>
        <p>Small performance penalty from requiring dimensionality checks on every operation involving two vectors</p>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>